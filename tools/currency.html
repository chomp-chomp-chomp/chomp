<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter - Chomp Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/tools-recipes-style.css">
</head>
<body class="">
        <header class="site-header">
        <nav class="site-nav">
            <a href="https://chompchomp.cc" class="site-logo">
                <div class="site-logo-icon">
                    <img src="https://res.cloudinary.com/dlqfyv1...183/IMG_3432_w3bid3.png" alt="Chomp Chomp" class="logo-default">
                    <img src="https://res.cloudinary.com/dlqfyv1...35197/IMG_3433_rqvbzu.jpg" alt="Chomp Chomp" class="logo-hover">
                </div>
                <span class="site-logo-text">chomp chomp</span>
            </a>

            <div class="nav-links">
                <a href="https://chompchomp.cc/recipes.html">recipes</a>
                <a href="https://chompchomp.cc/manifesto.html">manifesto</a>
                <a href="https://chompchomp.cc/tools.html" class="active">tools</a>
            </div>

            <div class="nav-right">
                <button class="tools-menu-toggle" onclick="toggleToolsDropdown()" aria-label="Toggle tools menu">
                    tools
                </button>
                <ul class="tools-dropdown" id="toolsDropdown">
                    <li><a href="https://chompchomp.cc/tools.html">Tools Index</a></li>
                    <li><a href="https://chompchomp.cc/tools-weather.html">Weather</a></li>
                    <li><a href="https://chompchomp.cc/tools-currency.html">Currency</a></li>
                    <li><a href="https://chompchomp.cc/tools-subnet.html">Subnet</a></li>
                    <li><a href="https://chompchomp.cc/tools-url.html">URL Tools</a></li>
                    <li><a href="https://chompchomp.cc/tools-wikipedia.html">Random Wikipedia</a></li>
                </ul>
            </div>
        </nav>
    </header>


    <div class="page-container">
        <div class="tool-page">
            <div class="tool-header">
                <picture>
                    <source srcset="https://ik.imagekit.io/chomp...ssed_-_dark_4hw2yuFvr.JPG" media="(prefers-color-scheme: dark)">
                    <picture><source srcset="https://ik.imagekit...mp_logos.png_2eqSaeGtE.jpeg" alt="currency converter"></picture>
                </picture>
                <h1 style="margin: 16px 0 6px 0;"><span style="c...tyle="color: rgb(231, 59, 66); text-decoration-line: underline; 
                </span></h1>
                <p class="tool-description">
                    Convert major currencies using daily reference rates from the European Central Bank (ECB).
                </p>
            </div>

            <div class="tool-card">
                <form id="currencyForm" class="tool-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fromCurrency">From</label>
                            <select id="fromCurrency" required></select>
                        </div>

                        <button type="button" class="swap-button" id="swapButton" aria-label="Swap currencies">
                            ⇄
                        </button>

                        <div class="form-group">
                            <label for="toCurrency">To</label>
                            <select id="toCurrency" required></select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount">Amount</label>
                            <input type="number" id="amount" value="1" min="0" step="0.01" required>
                        </div>

                        <div class="form-group">
                            <label for="rateDate">Date (optional)</label>
                            <input type="date" id="rateDate">
                        </div>
                    </div>

                    <button type="submit" class="tool-button">Convert</button>
                </form>

                <div class="tool-result" id="conversionResult" style="display:none;">
                    <div class="result-main">
                        <div class="result-amount" id="convertedAmount"></div>
                        <div class="result-rate" id="conversionRate"></div>
                        <div class="result-meta" id="rateTimestamp"></div>
                        <div class="result-meta" id="dataSource"></div>
                    </div>
                </div>

                <div class="tool-error" id="conversionError" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <h2>Popular Rates</h2>
                <p class="tool-description">Quick view of common conversions (updated with latest ECB rate).</p>
                <div class="popular-rates" id="popularRates">
                    <ul id="popularRatesList"></ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-inner">
            <div class="footer-left">
                <a href="https://chompchomp.cc">chomp chomp: recipes &amp; rituals</a>
            </div>
            <p style="margin-top: 15px;">© 2025 Chomp Chomp</p>
        </div>
    </footer>

    <script>
const ECB_API_BASE = 'https://data-api.ecb.europa.eu/service/data/EXR';
        const ECB_SERIES_SUFFIX = 'SP00.A';
        const ecbCurrencies = {
            AUD: 'Australian Dollar',
            BGN: 'Bulgarian Lev',
            BRL: 'Brazilian Real',
            CAD: 'Canadian Dollar',
            CHF: 'Swiss Franc',
            CNY: 'Chinese Yuan Renminbi',
            CZK: 'Czech Koruna',
            DKK: 'Danish Krone',
            EUR: 'Euro',
            GBP: 'British Pound Sterling',
            HKD: 'Hong Kong Dollar',
            HUF: 'Hungarian Forint',
            IDR: 'Indonesian Rupiah',
            ILS: 'Israeli Shekel',
            INR: 'Indian Rupee',
            ISK: 'Icelandic Krona',
            JPY: 'Japanese Yen',
            KRW: 'South Korean Won',
            MXN: 'Mexican Peso',
            MYR: 'Malaysian Ringgit',
            NOK: 'Norwegian Krone',
            NZD: 'New Zealand Dollar',
            PHP: 'Philippine Peso',
            PLN: 'Polish Zloty',
            RON: 'Romanian Leu',
            SEK: 'Swedish Krona',
            SGD: 'Singapore Dollar',
            THB: 'Thai Baht',
            TRY: 'Turkish Lira',
            USD: 'US Dollar',
            ZAR: 'South African Rand',
        };

        const popularPairs = [
            { from: 'USD', to: 'EUR' },
            { from: 'EUR', to: 'USD' },
            { from: 'GBP', to: 'EUR' },
            { from: 'EUR', to: 'GBP' },
            { from: 'JPY', to: 'EUR' },
            { from: 'CAD', to: 'EUR' },
        ];

        const fromSelect = document.getElementById('fromCurrency');
        const toSelect = document.getElementById('toCurrency');
        const amountInput = document.getElementById('amount');
        const rateDateInput = document.getElementById('rateDate');
        const resultContainer = document.getElementById('conversionResult');
        const convertedAmountEl = document.getElementById('convertedAmount');
        const conversionRateEl = document.getElementById('conversionRate');
        const rateTimestampEl = document.getElementById('rateTimestamp');
        const dataSourceEl = document.getElementById('dataSource');
        const popularRatesBox = document.getElementById('popularRates');
        const popularRatesList = document.getElementById('popularRatesList');

        function toggleToolsDropdown() {
            const dropdown = document.getElementById('toolsDropdown');
            dropdown.classList.toggle('active');
        }

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('toolsDropdown');
            const toggle = document.querySelector('.tools-menu-toggle');
            if (!dropdown || !toggle) return;
            if (!dropdown.contains(e.target) && !toggle.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        function populateSelect(selectEl, items, defaultKey) {
            selectEl.innerHTML = '';
            Object.keys(items).sort().forEach((code) => {
                const opt = document.createElement('option');
                opt.value = code;
                opt.textContent = `${code} — ${items[code]}`;
                if (code === defaultKey) opt.selected = true;
                selectEl.appendChild(opt);
            });
        }

        function loadCurrencies() {
            populateSelect(fromSelect, ecbCurrencies, 'USD');
            populateSelect(toSelect, ecbCurrencies, 'EUR');
        }

        function setMaxDate() {
            const today = new Date().toISOString().split('T')[0];
            rateDateInput.max = today;
        }

        function swapCurrencies() {
            const fromVal = fromSelect.value;
            fromSelect.value = toSelect.value;
            toSelect.value = fromVal;
        }

        function showError(message) {
            const el = document.getElementById('conversionError');
            el.textContent = message;
            el.style.display = 'block';
            resultContainer.style.display = 'none';
        }

        function clearError() {
            const el = document.getElementById('conversionError');
            el.textContent = '';
            el.style.display = 'none';
        }

        function buildEcbUrl(currency, params) {
            const seriesKey = `D.${currency}.EUR.${ECB_SERIES_SUFFIX}`;
            // Keep payload small and consistent
            if (!params.has('detail')) params.set('detail', 'dataonly');
            if (!params.has('format')) params.set('format', 'jsondata');
            return `${ECB_API_BASE}/${seriesKey}?${params.toString()}`;
        }

        function extractObservation(payload) {
            const seriesCollection = payload?.dataSets?.[0]?.series;
            if (!seriesCollection) return null;

            const firstSeriesKey = Object.keys(seriesCollection || {})[0];
            const observations = firstSeriesKey ? seriesCollection[firstSeriesKey]?.observations : null;
            const firstObservation = observations ? Object.entries(observations)[0] : null;
            if (!firstObservation) return null;

            const [obsIndex, values] = firstObservation;
            const rateValue = Array.isArray(values) ? values[0] : values;

            const timeDimension = payload?.structure?.dimensions?.observation?.[0]?.values?.[Number(obsIndex)];
            const dateValue = timeDimension?.id || timeDimension?.name || '';

            return { rate: rateValue, date: dateValue };
        }

        async function fetchEcbRate(currency, date) {
            if (currency === 'EUR') {
                return { rate: 1, date: date || 'Latest available' };
            }

            const primaryParams = new URLSearchParams();
            if (date) {
                primaryParams.set('startPeriod', date);
                primaryParams.set('endPeriod', date);
            } else {
                primaryParams.set('lastNObservations', '1');
            }

            const primaryRes = await fetch(buildEcbUrl(currency, primaryParams), { headers: { 'Accept': 'application/json' } });
            if (!primaryRes.ok) {
                throw new Error(`ECB data unavailable (${primaryRes.status})`);
            }

            let payload = await primaryRes.json();
            let observation = extractObservation(payload);
            let numericRate = Number(observation?.rate);

            // If the market was closed (weekend/holiday), request the latest observation up to that date.
            if ((!observation || !Number.isFinite(numericRate)) && date) {
                const fallbackParams = new URLSearchParams({
                    endPeriod: date,
                    lastNObservations: '1',
                });

                const fallbackRes = await fetch(buildEcbUrl(currency, fallbackParams), { headers: { 'Accept': 'application/json' } });
                if (!fallbackRes.ok) {
                    throw new Error(`ECB data unavailable (${fallbackRes.status})`);
                }

                payload = await fallbackRes.json();
                observation = extractObservation(payload);
            }

            numericRate = Number(observation?.rate);

            if (!observation || !Number.isFinite(numericRate)) {
                throw new Error('No ECB data available for this currency on the requested date.');
            }

            return {
                rate: numericRate,
                date: observation.date || date || 'Latest available',
            };
        }

        async function convertCurrencies({ from, to, amount, date }) {
            if (from === to) {
                return { converted: amount, rate: 1, date: date || 'Latest available' };
            }

            // ECB series are quoted as 1 EUR = X {currency}
            const fromRateObj = await fetchEcbRate(from, date);
            const toRateObj = await fetchEcbRate(to, date);

            const fromPerEur = fromRateObj.rate; // 1 EUR = fromPerEur FROM
            const toPerEur = toRateObj.rate;     // 1 EUR = toPerEur TO

            // Convert: amount FROM -> EUR -> TO
            const eurAmount = (from === 'EUR') ? amount : (amount / fromPerEur);
            const converted = (to === 'EUR') ? eurAmount : (eurAmount * toPerEur);

            // Effective cross rate: 1 FROM = ? TO
            const crossRate = (to === 'EUR')
                ? (1 / fromPerEur)
                : (from === 'EUR')
                    ? toPerEur
                    : (toPerEur / fromPerEur);

            // Prefer an actual observation date when available
            const effectiveDate = (fromRateObj.date && fromRateObj.date !== 'Latest available')
                ? fromRateObj.date
                : (toRateObj.date && toRateObj.date !== 'Latest available')
                    ? toRateObj.date
                    : (date || 'Latest available');

            return {
                converted,
                rate: crossRate,
                date: effectiveDate,
            };
        }

        function formatMoney(value, currency) {
            try {
                return new Intl.NumberFormat(undefined, {
                    style: 'currency',
                    currency,
                    maximumFractionDigits: 2,
                }).format(value);
            } catch {
                return `${value.toFixed(2)} ${currency}`;
            }
        }

        function formatRate(value, from, to) {
            const rate = Number(value);
            if (!Number.isFinite(rate)) return '';
            return `1 ${from} = ${rate.toFixed(6)} ${to}`;
        }

        async function renderPopularRates() {
            popularRatesList.innerHTML = '';
            for (const pair of popularPairs) {
                try {
                    const res = await convertCurrencies({ from: pair.from, to: pair.to, amount: 1, date: '' });
                    const li = document.createElement('li');
                    li.textContent = formatRate(res.rate, pair.from, pair.to);
                    popularRatesList.appendChild(li);
                } catch (e) {
                    // If one fails, skip it quietly
                }
            }
        }

        document.getElementById('swapButton').addEventListener('click', swapCurrencies);

        document.getElementById('currencyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearError();

            const from = fromSelect.value;
            const to = toSelect.value;
            const amount = Number(amountInput.value);
            const date = rateDateInput.value;

            if (!Number.isFinite(amount) || amount < 0) {
                showError('Please enter a valid amount.');
                return;
            }

            try {
                const res = await convertCurrencies({ from, to, amount, date });

                resultContainer.style.display = 'block';
                convertedAmountEl.textContent = formatMoney(res.converted, to);
                conversionRateEl.textContent = formatRate(res.rate, from, to);
                rateTimestampEl.textContent = `Rate date: ${res.date}`;
                dataSourceEl.textContent = 'Source: European Central Bank (ECB)';
            } catch (err) {
                showError(err?.message || 'Conversion failed. Please try again.');
            }
        });

        // Init
        loadCurrencies();
        setMaxDate();
        renderPopularRates();
    </script>

</body></html>