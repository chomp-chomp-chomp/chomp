<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text Tools - Chomp Tools</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/tools-recipes-style.css">
</head>

<body>
  <header class="site-header">
    <nav class="site-nav">
      <a href="https://chompchomp.cc" class="site-logo">
        <div class="site-logo-icon">
          <img src="https://res.cloudinary.com/dlqfyv1qj/image/upload/v1766535183/IMG_3432_w3bid3.png" alt="Chomp Chomp" class="logo-default">
          <img src="https://res.cloudinary.com/dlqfyv1qj/image/upload/v1766535197/IMG_3433_rqvbzu.jpg" alt="Chomp Chomp" class="logo-hover">
        </div>
      </a>

      <button class="menu-toggle" aria-label="Toggle menu">☰</button>

      <div class="nav-tools-dropdown">
        <button class="tools-dropdown-btn" onclick="toggleToolsDropdown()">Menu ▼</button>
        <ul class="tools-dropdown-menu" id="toolsDropdown">
          <li><a href="../index.html">Home</a></li>
          <li class="menu-item-has-submenu">
            <a href="#">Content</a>
            <ul class="submenu">
              <li><a href="../stories.html">Stories</a></li>
              <li><a href="../recipes.html">Recipes</a></li>
              <li><a href="../lexicon.html">Lexicon</a></li>
              <li><a href="../reading-list.html">Reading List</a></li>
            </ul>
          </li>
          <li><a href="../about.html">About</a></li>
          <li><a href="../store.html">Store</a></li>

          <li class="menu-item-has-submenu">
            <a href="#">Tools</a>
            <ul class="submenu">
              <li><a href="index.html">Index</a></li>
              <li><a href="ip.html">Whois</a></li>
              <li><a href="weather.html">Weather</a></li>
              <li><a href="convert.html">Convert</a></li>
              <li><a href="currency.html">Currency</a></li>
              <li><a href="encode.html">Encode</a></li>
              <li><a href="subnet.html">Subnet</a></li>
              <!-- Add your new page link wherever you want in the list -->
              <li><a href="text.html" class="active">Text</a></li>
            </ul>
          </li>

          <li class="menu-item-has-submenu">
            <a href="#">Ipsum</a>
            <ul class="submenu">
              <li><a href="baking.html">Baking</a></li>
              <li><a href="dante.html">Inferno</a></li>
              <li><a href="nautical.html">Nautical</a></li>
              <li><a href="philosophy.html">Philosophy</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <div class="page-container">
    <div class="tool-page">

      <div class="tool-header">
        <picture>
          <source srcset="https://firebasestorage.googleapis.com/v0/b/chomp-chomp-recipes.firebasestorage.app/o/posts%2FText%20-%20dark.JPG?alt=media"
                  media="(prefers-color-scheme: dark)">
          <img src="https://res.cloudinary.com/dlqfyv1qj/image/upload/v1766531919/1764737720669_vert_l9ko5a.jpg" alt="text tools">
        </picture>

        <p class="tool-subtitle">Analyze and transform text with counting, casing &amp; cleanup tools</p>
      </div>

      <div class="tool-controls">
        <div class="control-group">
          <label class="control-label" for="inputText">Input</label>
          <textarea id="inputText" class="form-input" placeholder="Paste or type text here…" rows="10" style="width: 100%; resize: vertical;"></textarea>
          <small style="display:block; color: var(--color-text-secondary); margin-top: 6px;">
            Tip: Most actions modify the text in place. Use Copy/Undo if you want to preserve a version.
          </small>
        </div>

        <div class="tool-actions" style="gap: 10px; flex-wrap: wrap;">
          <button class="tool-button" id="copyBtn" type="button">Copy</button>
          <button class="tool-button tool-button-secondary" id="undoBtn" type="button" disabled>Undo</button>
          <button class="tool-button tool-button-secondary" id="resetBtn" type="button">Reset</button>
        </div>
      </div>

      <div class="tool-results" id="results" style="display: block;">
        <div class="result-item">
          <div class="result-label">Characters (with spaces)</div>
          <div class="result-value" id="charsWithSpaces">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">Characters (no spaces)</div>
          <div class="result-value" id="charsNoSpaces">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">Words</div>
          <div class="result-value" id="wordCount">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">Lines</div>
          <div class="result-value" id="lineCount">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">Sentences (basic)</div>
          <div class="result-value" id="sentenceCount">0</div>
        </div>
      </div>

      <div class="tool-controls" style="margin-top: 18px;">
        <div class="control-group">
          <label class="control-label">Core</label>
          <div style="display:flex; gap: 10px; flex-wrap: wrap;">
            <button class="tool-button tool-button-secondary" type="button" data-action="upper">UPPERCASE</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="lower">lowercase</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="title">Title Case</button>

            <button class="tool-button tool-button-secondary" type="button" data-action="trim">Trim whitespace</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="collapseSpaces">Collapse spaces</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="removeBlankLines">Remove blank lines</button>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">Nice-to-have</label>
          <div style="display:flex; gap: 10px; flex-wrap: wrap;">
            <button class="tool-button tool-button-secondary" type="button" data-action="sortAsc">Sort lines A–Z</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="sortDesc">Sort lines Z–A</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="dedupeLines">Deduplicate lines</button>

            <button class="tool-button tool-button-secondary" type="button" data-action="reverseText">Reverse text</button>
            <button class="tool-button tool-button-secondary" type="button" data-action="reverseLines">Reverse lines</button>
          </div>

          <small style="display:block; color: var(--color-text-secondary); margin-top: 6px;">
            Sorting/deduping operate on lines; they preserve empty lines unless you remove them first.
          </small>
        </div>
      </div>

      <div class="info-box">
        <p style="margin: 0;">
          <strong>Note:</strong> “Sentence count” is a lightweight estimate based on punctuation and won’t be perfect for abbreviations, decimals, or highly structured text.
        </p>
      </div>

      <div style="text-align: center; margin-top: 40px;">
        <a href="index.html" class="btn btn-outline">← Back to Tools</a>
      </div>

    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="mailto:hey@chompchomp.cc">hey@chompchomp.cc</a>
        <a href="https://www.chomp.ltd">chomp chomp: cookies, etc.</a>
        <a href="https://chompchomp.cc">chomp chomp: recipes &amp; rituals</a>
      </div>
      <p style="margin-top: 15px;">&copy; 2025 Chomp Chomp</p>
    </div>
  </footer>

  <script>
    // Tools dropdown toggle
    function toggleToolsDropdown() {
      const dropdown = document.getElementById('toolsDropdown');
      dropdown.classList.toggle('active');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.nav-tools-dropdown')) {
        const dropdown = document.getElementById('toolsDropdown');
        if (dropdown) dropdown.classList.remove('active');
      }
    });

    // Mobile menu toggle
    const menuToggle = document.querySelector('.menu-toggle');
    const toolsDropdown = document.querySelector('.nav-tools-dropdown');
    if (menuToggle && toolsDropdown) {
      menuToggle.addEventListener('click', () => {
        toolsDropdown.classList.toggle('active');
      });
    }

    // --- Text tools logic ---
    const inputText = document.getElementById('inputText');

    const charsWithSpacesEl = document.getElementById('charsWithSpaces');
    const charsNoSpacesEl = document.getElementById('charsNoSpaces');
    const wordCountEl = document.getElementById('wordCount');
    const lineCountEl = document.getElementById('lineCount');
    const sentenceCountEl = document.getElementById('sentenceCount');

    const copyBtn = document.getElementById('copyBtn');
    const undoBtn = document.getElementById('undoBtn');
    const resetBtn = document.getElementById('resetBtn');

    // Simple undo stack (single-step is usually enough, but we can do more)
    const undoStack = [];

    function pushUndoState() {
      const current = inputText.value;
      if (undoStack.length === 0 || undoStack[undoStack.length - 1] !== current) {
        undoStack.push(current);
      }
      undoBtn.disabled = undoStack.length === 0;
    }

    function updateCounts() {
      const text = inputText.value || '';

      const charsWithSpaces = text.length;
      const charsNoSpaces = text.replace(/\s+/g, '').length;

      // Words: split on whitespace, ignore empties
      const words = text.trim().length ? text.trim().split(/\s+/).filter(Boolean) : [];
      const wordCount = words.length;

      // Lines: count newline-separated lines; treat empty as 0 lines
      const lines = text.length ? text.split(/\r\n|\r|\n/).length : 0;

      // Sentences (basic): count occurrences of ., !, ? ending segments
      // This is intentionally conservative and imperfect.
      const sentenceMatches = text
        .replace(/\s+/g, ' ')
        .trim()
        .match(/[^.!?]+[.!?]+(\s|$)/g);
      const sentenceCount = sentenceMatches ? sentenceMatches.length : (text.trim() ? 1 : 0);

      charsWithSpacesEl.textContent = String(charsWithSpaces);
      charsNoSpacesEl.textContent = String(charsNoSpaces);
      wordCountEl.textContent = String(wordCount);
      lineCountEl.textContent = String(lines);
      sentenceCountEl.textContent = String(sentenceCount);
    }

    function setText(next) {
      inputText.value = next;
      updateCounts();
    }

    function toTitleCase(str) {
      // Title-case each word, keep punctuation as-is
      // (Simple approach: split on whitespace)
      return str.replace(/\S+/g, (word) => {
        const first = word.charAt(0);
        const rest = word.slice(1);
        return first.toUpperCase() + rest.toLowerCase();
      });
    }

    function getLines(text) {
      return text.split(/\r\n|\r|\n/);
    }

    function joinLines(lines) {
      return lines.join('\n');
    }

    function applyAction(action) {
      const text = inputText.value || '';

      // No-op actions shouldn’t create undo states
      if (!text && !['trim', 'collapseSpaces', 'removeBlankLines'].includes(action)) {
        return;
      }

      // Save state before modification
      pushUndoState();

      let next = text;

      switch (action) {
        // Core
        case 'upper':
          next = text.toUpperCase();
          break;
        case 'lower':
          next = text.toLowerCase();
          break;
        case 'title':
          next = toTitleCase(text);
          break;
        case 'trim':
          // Trim each line + overall
          next = getLines(text).map(l => l.trim()).join('\n').trim();
          break;
        case 'collapseSpaces':
          // Collapse multiple spaces/tabs (preserve newlines)
          next = text
            .split(/\r\n|\r|\n/)
            .map(line => line.replace(/[ \t]+/g, ' ').trimEnd())
            .join('\n');
          break;
        case 'removeBlankLines':
          next = getLines(text).filter(line => line.trim() !== '').join('\n');
          break;

        // Nice-to-have
        case 'sortAsc': {
          const lines = getLines(text);
          lines.sort((a, b) => a.localeCompare(b));
          next = joinLines(lines);
          break;
        }
        case 'sortDesc': {
          const lines = getLines(text);
          lines.sort((a, b) => b.localeCompare(a));
          next = joinLines(lines);
          break;
        }
        case 'dedupeLines': {
          const lines = getLines(text);
          const seen = new Set();
          const out = [];
          for (const line of lines) {
            if (!seen.has(line)) {
              seen.add(line);
              out.push(line);
            }
          }
          next = joinLines(out);
          break;
        }
        case 'reverseText':
          next = text.split('').reverse().join('');
          break;
        case 'reverseLines': {
          const lines = getLines(text).reverse();
          next = joinLines(lines);
          break;
        }
        default:
          // If unknown action, restore undo state push
          undoStack.pop();
          undoBtn.disabled = undoStack.length === 0;
          return;
      }

      setText(next);
    }

    // Button wiring
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const action = btn.getAttribute('data-action');
      applyAction(action);
    });

    inputText.addEventListener('input', updateCounts);

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(inputText.value || '');
        // Soft confirmation without changing layout:
        const original = copyBtn.textContent;
        copyBtn.textContent = 'Copied';
        setTimeout(() => (copyBtn.textContent = original), 900);
      } catch (err) {
        alert('Copy failed. Your browser may block clipboard access on this page.');
      }
    });

    undoBtn.addEventListener('click', () => {
      if (!undoStack.length) return;
      const prev = undoStack.pop();
      undoBtn.disabled = undoStack.length === 0;
      setText(prev);
    });

    resetBtn.addEventListener('click', () => {
      undoStack.length = 0;
      undoBtn.disabled = true;
      setText('');
      inputText.focus();
    });

    // Init
    updateCounts();
  </script>
</body>
</html>